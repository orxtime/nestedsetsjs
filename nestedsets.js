"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};exports.__esModule=!0,exports.NestedSet=void 0;var NestedSetItem=function(){},NestedSetNode=function(t,e,r,i,n,o,s){this._id=t,this.lkey=e,this.rkey=r,this.depth=i,this.childs=n,this.parentId=o,this.itemId=s},NestedSetRootNode=function(t){this._id=1,this.lkey=1,this.rkey=2,this.depth=1,this.childs=0,this.parentId=0,this.itemId=t},NestedSetEmptyNode=function(){this._id=0,this.lkey=0,this.rkey=0,this.depth=0,this.childs=0,this.parentId=0,this.itemId=0},NesteSetError=function(){this.LeftLessRight=[],this.ModKeys=[],this.Depth=[]},NestedSet=function(){function t(t,e){this.Structure=t||[],this.Data=e||[]}return t.prototype.setItem=function(t,e){return this.Data[t]=e,this.Data[t]},t.prototype.removeItem=function(t){var e=this;return void 0!==this.Data[t]&&(this.Structure.map((function(r){r.itemId===t&&e.removeNode(r._id)})),delete this.Data[t],!0)},t.prototype.addRoot=function(t){var e;return this.removeNodes(),e=void 0!==this.Data[t]?new NestedSetRootNode(t):new NestedSetRootNode(0),this.Structure.push(e),e._id},t.prototype.addNode=function(t,e){if(void 0!==this.Data[e]){var r=this.getNode(t,!0);if(this.isEmpty(r))return 0;var i=Math.max.apply(Math,this.Structure.map((function(t){return t._id})))||0;this.Structure=this.Structure.map((function(t){return t.lkey>r.rkey&&(t.lkey+=2,t.rkey+=2),t.rkey>=r.rkey&&t.lkey<r.rkey&&(t.rkey+=2),t}));var n=new NestedSetNode(i+1,r.rkey,r.rkey+1,r.depth+1,0,r._id,e);return(r=this.getNode(t,!1)).childs++,this.Structure.push(n),i+1}return 0},t.prototype.getNode=function(t,e){var r=this.Structure.filter((function(e){return e._id===t}));return Array.isArray(r)&&1===r.length?e?__assign({},r[0]):r[0]:new NestedSetEmptyNode},t.prototype.removeNode=function(t){var e=this.getNode(t,!0),r=this.getParent(t);return!this.isEmpty(e)&&(r.childs--,this.Structure=this.getNodes().filter((function(t){return!(t.lkey>=e.lkey&&t.rkey<=e.rkey)})).map((function(t){return t.rkey>e.rkey&&(t.lkey=t.lkey>e.lkey?t.lkey-(e.rkey-e.lkey+1):t.lkey,t.rkey=t.rkey-(e.rkey-e.lkey+1)),t})),!0)},t.prototype.moveNode=function(t,e){var r=this.getNode(t,!0),i=this.getNode(e,!0),n=r.depth,o=r.rkey,s=r.lkey,u=i.depth,h=i.rkey-1,y=u-n+1,d=o-s+1,p=0;return h>o?(p=h-s+1-d,this.Structure=this.Structure.map((function(t){return t.lkey<=h&&t.rkey>s&&(t.rkey<=o?t.lkey=t.lkey+p:t.lkey>o&&(t.lkey=t.lkey-d),t.rkey<=o&&(t.depth=t.depth+y),t.rkey<=o?t.rkey=t.rkey+p:t.rkey<=h&&(t.rkey=t.rkey-d)),t}))):(p=h-s+1,this.Structure=this.Structure.map((function(t){return t.rkey>h&&t.lkey<o&&(t.lkey>=s?t.rkey=t.rkey+p:t.rkey<s&&(t.rkey=t.rkey+d),t.lkey>=s&&(t.depth=t.depth+y),t.lkey>=s?t.lkey=t.lkey+p:t.lkey>h&&(t.lkey=t.lkey+d)),t}))),!0},t.prototype.getNodes=function(){return this.Structure.sort((function(t,e){return t.lkey-e.lkey}))},t.prototype.removeNodes=function(){return this.Structure=[],0===this.Structure.length},t.prototype.getParent=function(t){var e=this.getParents(t);return void 0===e[e.length-1]?new NestedSetEmptyNode:e[e.length-1]},t.prototype.getParents=function(t){var e=this,r=this.getNode(t,!1);return this.isEmpty(r)?[]:this.getNodes().filter((function(t){return t.lkey<r.lkey&&t.rkey>r.rkey})).map((function(t){return t.data=e.Data[t.itemId],t}))},t.prototype.getChilds=function(t,e){var r=this,i=this.getNode(t,!1);return this.isEmpty(i)?[]:this.getNodes().filter((function(r){return r.lkey>=i.lkey&&r.rkey<=i.rkey&&t!==r._id&&(void 0===e||r.depth<=i.depth+e)})).map((function(t){return t.data=r.Data[t.itemId],t}))},t.prototype.getBranch=function(t){var e=this,r=this.getNode(t,!1);return this.isEmpty(r)?[]:this.getNodes().filter((function(t){return t.rkey>r.lkey&&t.lkey<r.rkey})).map((function(t){return t.data=e.Data[t.itemId],t}))},t.prototype.getTree=function(){var t=this;return this.getNodes().map((function(e){return e.data=t.Data[e.itemId],e}))},t.prototype.clearAll=function(){return this.Structure=[],this.Data=[],0===this.Structure.length&&0===Object.keys(this.Data).length},t.prototype.isEmpty=function(t){return 0===t._id},t.prototype.isRoot=function(t){var e=this.getNode(t,!1);return!this.isEmpty(e)&&0===e.parentId},t.prototype.isBranch=function(t){var e=this.getNode(t,!1);return!this.isEmpty(e)&&e.childs>0},t.prototype.isLeaf=function(t){var e=this.getNode(t,!1);return!this.isEmpty(e)&&0===e.childs},t.prototype.getMaxRightKey=function(){return Math.max.apply(Math,this.Structure.map((function(t){return t.rkey})))},t.prototype.getMaxLeftKey=function(){return Math.max.apply(Math,this.Structure.map((function(t){return t.lkey})))},t.prototype.getCountNodes=function(){return this.Structure.length},t.prototype.checkTree=function(){var t=this.Structure.filter((function(t){return t.lkey>=t.rkey})),e=this.Structure.filter((function(t){return(t.rkey-t.lkey)%2==0})),r=this.Structure.filter((function(t){return(t.lkey-t.depth+2)%2==1})),i=[];return 0!==t.length&&i.push({LeftLessRight:t}),0!==e.length&&i.push({ModKeys:e}),0!==r.length&&i.push({Depth:r}),i},t.prototype.debug=function(){var t=this;return this.getNodes().map((function(e){return String(" ").repeat(e.depth+1)+"> "+JSON.stringify(t.Data[e.itemId])+"(itemId:"+e.itemId+"; nodeId:"+e._id+"; lkey:"+e.lkey+"; rkey:"+e.rkey+"; depth:"+e.depth+"; childs:"+e.childs+")"}))},t}();exports.NestedSet=NestedSet,module.exports=function(){return new NestedSet};
