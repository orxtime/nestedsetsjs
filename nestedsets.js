module.exports=function(){var e={Structure:[],Data:{},setItem:(t,r)=>(e.Data[t]=r,e.Data[t]),removeItem:t=>{if(void 0!==e.Data[t]){for(var r=0;r<e.Structure.length;r++)e.Structure[r].itemId===t&&e.removeNode(e.Structure[r]._id);return delete e.Data[t],!0}return!1},addRoot:t=>(void 0!==e.Data[t]&&(e.removeNodes(),e.Structure.push({_id:1,lkey:1,rkey:2,depth:1,childs:0,parentId:0,itemId:t})),e.Structure[0]._id),addNode:(t,r)=>{if(void 0!==e.Data[r]){var y=e.getNode(t,!0);if(!y)return!1;var k=Math.max(...e.Structure.map(e=>e._id))||0;return e.Structure=e.Structure.map(e=>(e.lkey>y.rkey&&(e.lkey+=2,e.rkey+=2),e.rkey>=y.rkey&&e.lkey<y.rkey&&(e.rkey+=2,e.childs++),e)),e.Structure.push({_id:k+1,lkey:y.rkey,rkey:y.rkey+1,depth:y.depth+1,childs:0,parentId:y._id,itemId:r}),k+1}},getNode:(t,r)=>{var y=e.Structure.filter(e=>e._id===t);return!(!Array.isArray(y)||1!==y.length)&&(!0===r?{...y[0]}:y[0])},removeNode:t=>{var r=e.getNode(t,!0),y=e.getChilds(t).length+1;return!!r&&(e.Structure=e.getNodes().map(e=>(e.rkey>r.rkey&&e.lkey<r.lkey&&(e.childs=e.childs-y),e)).filter(e=>!(e.lkey>=r.lkey&&e.rkey<=r.rkey)).map(e=>(e.rkey>r.rkey&&(e.lkey=e.lkey>r.lkey?e.lkey-(r.rkey-r.lkey+1):e.lkey,e.rkey=e.rkey-(r.rkey-r.lkey+1)),e)),e.Structure)},moveNode:(t,r)=>{var y,k=e.getNode(t,!0),d=e.getNode(r,!0),a=k.depth,l=k.rkey,u=k.lkey,i=d.depth,h=d.rkey-1,o=i-a+1,g=l-u+1;h>l?(y=h-u+1-g,e.Structure=e.Structure.map(e=>(e.lkey<=h&&e.rkey>u&&(e.rkey<=l?e.lkey=e.lkey+y:e.lkey>l&&(e.lkey=e.lkey-g),e.rkey<=l&&(e.depth=e.depth+o),e.rkey<=l?e.rkey=e.rkey+y:e.rkey<=h&&(e.rkey=e.rkey-g)),e))):(y=h-u+1,e.Structure=e.Structure.map(e=>(e.rkey>h&&e.lkey<l&&(e.lkey>=u?e.rkey=e.rkey+y:e.rkey<u&&(e.rkey=e.rkey+g),e.lkey>=u&&(e.depth=e.depth+o),e.lkey>=u?e.lkey=e.lkey+y:e.lkey>h&&(e.lkey=e.lkey+g)),e)))},getNodes:()=>e.Structure.sort((e,t)=>e.lkey-t.lkey),removeNodes:()=>{e.Structure=[]},getParent:t=>{var r=e.getParents(t);return void 0!==r[r.length-1]&&r[r.length-1]},getParents:t=>{var r=e.getNode(t,!0);return r?e.getNodes().filter(e=>e.lkey<r.lkey&&e.rkey>r.rkey).map(t=>(t.data=e.Data[t.itemId],t)):[]},getChilds:(t,r)=>{var y=e.getNode(t,!0);return y?e.getNodes().filter(e=>e.lkey>=y.lkey&&e.rkey<=y.rkey&&t!==e._id&&(void 0===r||e.depth<=y.depth+r)).map(t=>(t.data=e.Data[t.itemId],t)):[]},getBranch:t=>{var r=e.getNode(t);return r?e.getNodes().filter(e=>e.rkey>r.lkey&&e.lkey<r.rkey).map(t=>(t.data=e.Data[t.itemId],t)):[]},getTree:()=>e.getNodes().map(t=>(t.data=e.Data[t.itemId],t)),clearAll:()=>{e.Structure=[],e.Data={}},isRoot:t=>{var r=e.getNode(t);return r&&0===r.parentId},isBranch:t=>{var r=e.getNode(t);return r&&r.childs>0},isLeaf:t=>{var r=e.getNode(t);return r&&0===r.childs},getMaxRightKey:()=>Math.max(...e.Structure.map(e=>e.rkey)),getMaxLeftKey:()=>Math.max(...e.Structure.map(e=>e.lkey)),getCountNodes:()=>e.Structure.length,checkTree:()=>{var t=e.Structure.filter(e=>e.lkey>=e.rkey),r=e.Structure.filter(e=>(e.rkey-e.lkey)%2==0),y=e.Structure.filter(e=>(e.lkey-e.depth+2)%2==1),k=[];return 0!==t.length&&k.push({LeftLessRight:t}),0!==r.length&&k.push({ModKeys:r}),0!==y.length&&k.push({Depth:y}),k},debug:()=>e.getNodes().map(t=>String(" ").repeat(t.depth+1)+"> "+JSON.stringify(e.Data[t.itemId])+"(itemId:"+t.itemId+"; nodeId:"+t._id+"; lkey:"+t.lkey+"; rkey:"+t.rkey+"; depth:"+t.depth+"; childs:"+t.childs+")")};return e};
