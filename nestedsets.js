var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},NestedSetItem=function(){},NestedSetNode=function(t,e,r,i,n,u,o){this._id=t,this.lkey=e,this.rkey=r,this.depth=i,this.childs=n,this.parentId=u,this.itemId=o},NestedSetRootNode=function(t){this._id=1,this.lkey=1,this.rkey=2,this.depth=1,this.childs=0,this.parentId=0,this.itemId=t},NesteSetError=function(){this.LeftLessRight=[],this.ModKeys=[],this.Depth=[]},NestedSet=function(){function t(t,e){this.Structure=t,this.Data=e}return t.prototype.setItem=function(t,e){return this.Data[t]=e,this.Data[t]},t.prototype.removeItem=function(t){if(void 0!==this.Data[t]){for(var e=0;e<this.Structure.length;e++)if(this.Structure[e].itemId===t){for(var r=this.getChilds(this.Structure[e]._id,1/0),i=0;i<r.length;i++)this.removeNode(r[i]._id);this.Structure.splice(e,1)}return delete this.Data[t],!0}return!1},t.prototype.addRoot=function(t){if(void 0!==this.Data[t]){this.removeNodes();var e=new NestedSetRootNode(t);this.Structure.push(e)}return this.Structure[0]._id},t.prototype.addNode=function(t,e){if(void 0!==this.Data[e]){var r=this.getNode(t,!0);if(0===r._id)return 0;var i=Math.max.apply(Math,this.Structure.map((function(t){return t._id})))||0;this.Structure=this.Structure.map((function(t){return t.lkey>r.rkey&&(t.lkey+=2,t.rkey+=2),t.rkey>=r.rkey&&t.lkey<r.rkey&&(t.rkey+=2),t}));var n=new NestedSetNode(i+1,r.rkey,r.rkey+1,r.depth+1,0,r._id,e);return(r=this.getNode(t,!1)).childs++,this.Structure.push(n),i+1}return 0},t.prototype.getNode=function(t,e){var r=this.Structure.filter((function(e){return e._id===t}));if(Array.isArray(r)&&1===r.length){if(e){var i=new NestedSetNode(0,0,0,0,0,0,0);return __assign(__assign({},i),r[0])}return r[0]}return new NestedSetNode(0,0,0,0,0,0,0)},t.prototype.removeNode=function(t){var e=this.getNode(t,!0),r=this.getParent(t);return 0!==e._id&&(r.childs--,this.Structure=this.getNodes().filter((function(t){return!(t.lkey>=e.lkey&&t.rkey<=e.rkey)})).map((function(t){return t.rkey>e.rkey&&(t.lkey=t.lkey>e.lkey?t.lkey-(e.rkey-e.lkey+1):t.lkey,t.rkey=t.rkey-(e.rkey-e.lkey+1)),t})),!0)},t.prototype.moveNode=function(t,e){var r=this.getNode(t,!0),i=this.getNode(e,!0),n=r.depth,u=r.rkey,o=r.lkey,s=i.depth,h=i.rkey-1,y=s-n+1,d=u-o+1,a=0;return h>u?(a=h-o+1-d,this.Structure=this.Structure.map((function(t){return t.lkey<=h&&t.rkey>o&&(t.rkey<=u?t.lkey=t.lkey+a:t.lkey>u&&(t.lkey=t.lkey-d),t.rkey<=u&&(t.depth=t.depth+y),t.rkey<=u?t.rkey=t.rkey+a:t.rkey<=h&&(t.rkey=t.rkey-d)),t}))):(a=h-o+1,this.Structure=this.Structure.map((function(t){return t.rkey>h&&t.lkey<u&&(t.lkey>=o?t.rkey=t.rkey+a:t.rkey<o&&(t.rkey=t.rkey+d),t.lkey>=o&&(t.depth=t.depth+y),t.lkey>=o?t.lkey=t.lkey+a:t.lkey>h&&(t.lkey=t.lkey+d)),t}))),!0},t.prototype.getNodes=function(){return this.Structure.sort((function(t,e){return t.lkey-e.lkey}))},t.prototype.removeNodes=function(){return this.Structure=[],0===this.Structure.length},t.prototype.getParent=function(t){var e=this.getParents(t);return void 0===e[e.length-1]?new NestedSetNode(0,0,0,0,0,0,0):e[e.length-1]},t.prototype.getParents=function(t){var e=this,r=this.getNode(t,!1);if(0===r._id)return[];var i=this.getNodes().filter((function(t){return t.lkey<r.lkey&&t.rkey>r.rkey}));if(i.length>0){var n=[];i.sort((function(t,e){return t.lkey>e.lkey?1:t.lkey<e.lkey?-1:0})).map((function(t){t.data=e.Data[t.itemId],n.push(t)})),i=n}return i},t.prototype.getChilds=function(t,e){var r=this,i=this.getNode(t,!1);if(0===i._id)return[];var n=this.getNodes().filter((function(r){return r.lkey>=i.lkey&&r.rkey<=i.rkey&&t!==r._id&&(void 0===e||r.depth<=i.depth+e)}));if(n.length>0){var u=[];n.sort((function(t,e){return t.lkey>e.lkey?1:t.lkey<e.lkey?-1:0})).map((function(t){t.data=r.Data[t.itemId],u.push(t)})),n=u}return n},t.prototype.getBranch=function(t){var e=this,r=this.getNode(t,!1);if(0===r._id)return[];var i=this.getNodes().filter((function(t){return t.rkey>r.lkey&&t.lkey<r.rkey}));if(i.length>0){var n=[];i.sort((function(t,e){return t.lkey>e.lkey?1:t.lkey<e.lkey?-1:0})).map((function(t){t.data=e.Data[t.itemId],n.push(t)})),i=n}return i},t.prototype.getTree=function(){var t=this,e=[];return this.getNodes().sort((function(t,e){return t.lkey>e.lkey?1:t.lkey<e.lkey?-1:0})).map((function(r){r.data=t.Data[r.itemId],e.push(r)})),e},t.prototype.clearAll=function(){return this.Structure=[],this.Data=[],0===this.Structure.length&&0===Object.keys(this.Data).length},t.prototype.isRoot=function(t){var e=this.getNode(t,!1);return 0!==e._id&&0===e.parentId},t.prototype.isBranch=function(t){var e=this.getNode(t,!1);return 0!==e._id&&e.childs>0},t.prototype.isLeaf=function(t){var e=this.getNode(t,!1);return 0!==e._id&&0===e.childs},t.prototype.getMaxRightKey=function(){return Math.max.apply(Math,this.Structure.map((function(t){return t.rkey})))},t.prototype.getMaxLeftKey=function(){return Math.max.apply(Math,this.Structure.map((function(t){return t.lkey})))},t.prototype.getCountNodes=function(){return this.Structure.length},t.prototype.checkTree=function(){var t=this.Structure.filter((function(t){return t.lkey>=t.rkey})),e=this.Structure.filter((function(t){return(t.rkey-t.lkey)%2==0})),r=this.Structure.filter((function(t){return(t.lkey-t.depth+2)%2==1})),i=[];return 0!==t.length&&i.push({LeftLessRight:t}),0!==e.length&&i.push({ModKeys:e}),0!==r.length&&i.push({Depth:r}),i},t.prototype.debug=function(){var t=this,e=[];return this.getNodes().map((function(r){e.push(" ".repeat(r.depth+1)+"> "+JSON.stringify(t.Data[r.itemId])+"(itemId:"+r.itemId+"; nodeId:"+r._id+"; lkey:"+r.lkey+"; rkey:"+r.rkey+"; depth:"+r.depth+"; childs:"+r.childs+")")})),e},t}();module.exports=function(){return new NestedSet([],[])};
